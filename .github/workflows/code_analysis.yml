name: 'Code Analysis'

on:
    pull_request: null
    push:
        # Prevent duplicating jobs on PR-s from local branches
        branches:
            - 'main'

jobs:
    code_analysis:
        strategy:
            fail-fast: false
            matrix:
                actions:
                    -
                        name: 'ECS'
                        run: 'composer run check-cs'
                    -
                        name: 'PHPStan'
                        run: 'composer run phpstan'
                    -
                        name: 'Unit Tests'
                        run: 'composer exec -- phpunit'
                    -
                        name: 'Check Commented Code'
                        run: 'composer exec -- easy-ci check-commented-code src tests --ansi'
                    -
                        name: 'Check Active Classes'
                        run: 'composer exec -- easy-ci check-active-class src --ansi'

        name: ${{ matrix.actions.name }}
        runs-on: 'ubuntu-latest'
        steps:
            -
                name: 'Checkout repository'
                uses: 'actions/checkout@v3'
            -
                name: 'Set up PHP'
                uses: 'shivammathur/setup-php@v2'
                with:
                    php-version: '8.1'
                    # needed by phpunit
                    extensions: 'mbstring'
            -
                # Composer install and cache - https://github.com/ramsey/composer-install
                name: 'Install dependencies'
                uses: 'ramsey/composer-install@v2'
            -
                run: ${{ matrix.actions.run }}
